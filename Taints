#vai

Hj iremos falar sobre Taints.

No Kubernetes, taints s√£o um mecanismo de controle de agendamento (scheduling) usado para impedir ou restringir que Pods sejam alocados em determinados Nodes, a menos que esses Pods declarem explicitamente que toleram essa restri√ß√£o.

Eles funcionam de forma inversa aos labels/affinity:
o Node ‚Äúrejeita‚Äù o Pod, em vez do Pod ‚Äúescolher‚Äù o Node.

Conceito b√°sico

Um taint √© aplicado no Node e possui tr√™s componentes:
key=value:effect

Exemplo:
dedicated=gpu:NoSchedule

Isso significa:
Nodes marcados com esse taint n√£o aceitam Pods
Exceto Pods que tenham uma toleration compat√≠vel

Effects (efeitos) do taint
1. NoSchedule
O scheduler n√£o agenda novos Pods
Pods existentes n√£o s√£o removidos
Uso t√≠pico:
Nodes dedicados (DB, GPU, workloads cr√≠ticos)

2. PreferNoSchedule
O scheduler evita, mas n√£o pro√≠be
Pode agendar se n√£o houver alternativa
Uso t√≠pico:
Workloads preferenciais, n√£o cr√≠ticos

3. NoExecute
Pods existentes s√£o removidos
Pods novos n√£o s√£o agendados
Pode haver um tolerationSeconds
Uso t√≠pico:
Nodes degradados
Manuten√ß√£o
Isolamento imediato

===============

kubectl taint nodes node-1 dedicated=infra:NoSchedule

Pod sem toleration

‚ùå N√£o ser√° agendado nesse Node

Pod com toleration
apiVersion: v1
kind: Pod
metadata:
  name: app
spec:
  tolerations:
  - key: "dedicated"
    operator: "Equal"
    value: "infra"
    effect: "NoSchedule"
  containers:
  - name: app
    image: nginx

Taints √ó Tolerations √ó Affinity
Recurso	Fun√ß√£o
Taint	Node rejeita Pods
Toleration	Pod aceita Node
NodeAffinity	Pod escolhe Node
PodAffinity	Pod quer estar perto de outros Pods

üëâ Normalmente, usa-se taints + tolerations junto com nodeSelector ou affinity para controle fino.

Casos comuns de uso

Separar workloads:

Infra

Aplica√ß√µes

Batch

Nodes com GPU

Nodes de banco de dados

Ambiente multi-tenant

Manuten√ß√£o de Nodes

Spot / Preemptible Nodes
======================================================================
Taint AntiAffinity, tb criamos um deploymente seguindo esse modelo de antiaffinity, isso ajudar a deixar de fato sua aplica√ß√£o 
mais segura, no caso n√£o deixando td em um s√≥ n√≥ do seu cluster.

apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: nginx
  name: nginx
spec:
  replicas: 4
  selector:
    matchLabels:
      app: nginx

  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - image: nginx
        name: nginx
        ports:
        - containerPort: 80
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app: nginx
            topologyKey: "az"
~                                                                                                                                                 
~                                                                                                                                                 
~                                                         

Nesse modelo usamos "topologyKey=az" for√ßando assim a colocar um pode em cada az ou tb podemos fazer por regi√£o, usando 
topologyKey: "az".

====================================================

Outro modelo √© o "preferred"

apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: nginx
  name: nginx
spec:
  replicas: 4
  selector:
    matchLabels:
      app: nginx

  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - image: nginx
        name: nginx
        ports:
        - containerPort: 80
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchLabels:
                  app: nginx
              topologyKey: "kubernetes.io/hostname"
~                                                                                                                                                 
~                                                            
==============================================================





